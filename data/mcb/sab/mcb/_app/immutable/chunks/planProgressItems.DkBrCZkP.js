import{o as g}from"./theme.CEnq8wkH.js";import{i as m,w as x}from"./entry.BaUVQd1j.js";let d=null;async function i(){return d||(d=await g("planprogressitems",1,{upgrade(e){const t=e.createObjectStore("planprogressitems",{keyPath:"key",autoIncrement:!0});t.createIndex("planIndex","id"),t.createIndex("dayIndex",["id","day"]),t.createIndex("singleItemIndex",["id","day","itemIndex"])}})),d}async function P(e){const t=await i(),r=new Date()[Symbol.toPrimitive]("number"),n={...e,date:r},s=t.transaction("planprogressitems","readwrite");(await s.store.index("singleItemIndex").getAll([e.id,e.day,e.itemIndex])).length===0&&(await s.store.add(n),await s.done,p())}async function w(e){return await(await i()).transaction("planprogressitems").store.index("planIndex").getAll(e)}async function u(e){if(e){const r=(await i()).transaction("planprogressitems","readwrite"),s=await r.store.index("planIndex").getAllKeys(e);for(const a of s)await r.store.delete(a);await r.done,console.log(`Plan: Deleted ${s.length} records with plan ID "${e}"`)}}async function c(e,t){return(await(await i()).transaction("planprogressitems").store.index("dayIndex").getAll([e,t])).map(l=>l.itemIndex)}async function R(e,t){let r=-1;for(let n=0;n<e.items.length;n++)if((await c(e.id,e.items[n].day)).length!==e.items[n].refs.length&&e.items[n].day!==t){r=e.items[n].day;break}return r}async function b(e,t,r){let n="",s=-1;const a=await c(e,t.day);for(let o=0;o<t.refs.length;o++)if(!a.includes(o)&&o!==r){s=o,n=t.refs[s];break}return[n,s]}function p(){f.set(Date.now()),m("planprogressitems")}const f=x(Date.now());export{R as a,b,P as c,u as d,w as g};
